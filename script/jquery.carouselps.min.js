/*
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~                   Carousel Plugin                   ~~
~~           Leon Slater, www.lpslater.co.uk           ~~
~~                    Version 1.0.0                    ~~
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
*/
(function(e){e.fn.carouselps=function(t){var n={fade:false,continuous:true,auto_slide:true,arrow_nav:true,bottom_nav:true,use_css3:true,swipe:true,responsive:true,adjust_height:false,slideChangeSpeed:7e3,animateSpeed:500};t=e.extend({},n,t);return this.each(function(){var n=e(this),r=n.children("li"),i=n.children("li:first-child"),s=n.children("li:last-child"),o=n.find(".current"),u,a,f,l,c,h,p,d=css3support=false,v,m=n.find("iframe").length,g=n.find("iframe"),y=false,b,w=[],E,S,x,T;var N={init:function(){n.wrap("<div class='carouselps-wrapper'><div class='carouselps-wrap'/></div>");if(!n.hasClass("carouselps")){n.removeClass().addClass("carouselps")}l=n.parents(".carouselps-wrapper");f=n.parent();i.addClass("current");if(t.arrow_nav){N.arrow_nav()}if(t.bottom_nav){N.bottom_nav()}if(t.fade){N.fade()}if(t.continuous){N.continuous()}o=n.find(".current");if(t.use_css3){N.use_css3()}N.calcs();if(t.auto_slide){N.auto_slide()}if(t.swipe){N.swipe()}},fade:function(){t.continuous=t.use_css3=false;t.adjust_height=true;r.css("position","absolute");r.hide();i.show()},use_css3:function(){var e=document.createElement("div"),t=["WebkitPerspective","MozPerspective","OPerspective","msPerspective"];for(var r in t){if(e.style[t[r]]!=undefined){css3support=true;S=t[r].replace("Perspective","").toLowerCase();E="-"+S+"-transform";n.css("-"+S+"-transition-property","-"+S+"-transform");n.css("-"+S+"-transition-duration","0s");n.css("-"+S+"-transition-timing-function","ease-out");return true}}},calcs:function(){r.width(f.innerWidth());if(!t.fade){if(t.use_css3&&css3support){n.css("-"+S+"-transition-duration","0s");n.css(E,"translate3d("+o.position().left*-1+"px, 0, 0)")}else{n.css("margin-left",""+o.position().left*-1+"px")}}if(t.adjust_height){n.height(o.height())}},continuous:function(){i.clone(true).insertAfter(s).addClass("clone").removeClass("current");s.clone(true).insertBefore(i).addClass("clone");u=n.find("li:first-child");a=n.find("li:last-child");r=n.children("li")},animate:function(){if(!d){d=true;if(t.auto_slide){clearTimeout(x)}switch(v){case"prev":if(!i.hasClass("current")||t.continuous){o.removeClass("current").prev().addClass("current")}else{o.removeClass("current");s.addClass("current")}break;case"next":if(!s.hasClass("current")||t.continuous){o.removeClass("current").next().addClass("current")}else{o.removeClass("current");i.addClass("current")}break;case"bottom":o.removeClass("current");var e=t.continuous?p+1:p;r.eq(e).addClass("current");break}o=n.find(".current");if(t.use_css3&&css3support){n.css("-"+S+"-transition-duration",t.animateSpeed/1e3+"s");n.css(E,"translate3d("+o.position().left*-1+"px, 0, 0)")}else{if(t.fade){r.fadeOut(t.animateSpeed);o.fadeIn(t.animateSpeed)}else{n.animate({marginLeft:o.position().left*-1},{duration:t.animateSpeed,queue:false})}}if(t.bottom_nav){h.removeClass("current");var e=t.continuous?a.hasClass("current")?i.index()-1:o.index()-1:o.index();h.eq(e).addClass("current")}if(n.height()!=o.height()&&t.adjust_height){n.animate({height:o.height()},{duration:t.animateSpeed,queue:false})}if(T){clearTimeout(T)}T=setTimeout(N.after_anim,t.animateSpeed+100)}if(t.auto_slide){y=false}},after_anim:function(){if(t.continuous){if(u.hasClass("current")||a.hasClass("current")){var e=u.hasClass("current")?s.position().left*-1:i.position().left*-1;if(t.use_css3&&css3support){n.css("-"+S+"-transition-duration","0s");n.css(E,"translate3d("+e+"px, 0, 0)")}else{n.css("margin-left"," "+e+"px")}if(u.hasClass("current")){s.addClass("current")}if(a.hasClass("current")){i.addClass("current")}o.removeClass("current");cloneUsed=true}o=n.find(".current")}d=false;if(t.auto_slide){v="next";x=setTimeout(N.animate,t.slideChangeSpeed)}},auto_slide:function(){v="next";x=setTimeout(N.animate,t.slideChangeSpeed);l.hover(function(){clearTimeout(x)},function(){if(!y){v="next";x=setTimeout(N.animate,t.slideChangeSpeed)}})},swipe:function(){function s(t){if(!d){f();if(t.originalEvent.touches){t=t.originalEvent.touches[0]}if(r==0){r=1;i=true;e=t.clientX;startY=t.clientY}n.on({touchend:a,touchmove:u})}}function u(s){if(i){dx=s.originalEvent.touches[0].clientX-e;dy=s.originalEvent.touches[0].clientY-startY;i=Math.abs(dx)<Math.abs(dy)}if(!i){s.preventDefault();if(s.originalEvent.touches){s=s.originalEvent.touches[0]}swipeDistanceX=s.clientX-e;swipeDistanceY=s.clientY-startY;if(r==1&&swipeDistanceX!=0){if(t.auto_slide){clearTimeout(x)}r=2;startXOffset=movementXOffset}if(r==2&&!t.fade&&css3support){movementXOffset=o.position().left*-1+swipeDistanceX;n.css("-"+S+"-transition-duration","0s");n.css(E,"translate3d("+movementXOffset+"px,0,0)")}}}function a(e){if(r==2){if(swipeDistanceX>80||swipeDistanceX<-80){if(swipeDistanceX>80){v="prev"}else if(swipeDistanceX<-80){v="next"}N.animate()}else{if(!t.fade&&css3support){n.css("-"+S+"-transition-duration",t.animateSpeed/1e3+"s");n.css(E,"translate3d("+o.position().left*-1+"px,0,0)")}if(t.auto_slide){v="next";x=setTimeout(N.animate,t.slideChangeSpeed)}}}n.off("touchmove, touchend");f()}function f(){e=startY=startXOffset=movementXOffset=startYOffset=movementYOffset=swipeDistanceX=swipeDistanceY=dx=dy=null;r=0;i=true}var e=startY=startXOffset=movementXOffset=startYOffset=movementYOffset=swipeDistanceX=swipeDistanceY=dx=dy=null,r=0,i;n.on("touchstart",s)},arrow_nav:function(){f.append('<ul class="carouselps-nav"><li class="prev"><a><</a></li><li class="next"><a>></a></li></ul>');$sliderBottomNavItem=f.find(".carouselps-nav li");$sliderBottomNavItem.click(function(){v=e(this).attr("class");N.animate()})},bottom_nav:function(){l.append('<ul class="carouselps-nav-bottom"/>');c=l.find(".carouselps-nav-bottom");r.each(function(){c.append("<li><a/></li>")});h=c.find("li");c.find("li:first-child").addClass("current");h.click(function(){p=parseInt(e(this).index());v="bottom";N.animate()})},youtube_exists:function(){g=n.find("iframe");g.each(function(){var t=e(this).height()/e(this).width()*100+"%";e(this).wrap("<div class='video-wrapper' style='padding-bottom: "+t+"' />");e(this).css({position:"absolute",height:"100%",width:"100%",top:"0",left:"0"})});g.hover(function(){if(x){clearTimeout(x)}y=true})}};N.init();e(window).bind("load",function(){if(m){N.youtube_exists()}if(t.adjust_height){n.height(o.height())}});if(t.responsive){var C,k=/android|webos|iphone|ipad|ipod|blackberry/i.test(navigator.userAgent.toLowerCase()),L=k?window.hasOwnProperty("orientation"):false,A=L?"orientationchange":"resize";e(window).bind(A,function(){if(C){clearTimeout(C)}C=setTimeout(function(){N.calcs()},100)})}})}})(jQuery)