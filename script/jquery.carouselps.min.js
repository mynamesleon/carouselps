/* Carousel Plugin | Leon Slater | www.lpslater.co.uk | Version 1.3.0 */
(function(e){var t=0,n=e(window);window.carouselpsOptions=[];e.fn.carouselps=function(r){var i={fade:false,continuous:true,responsive:true,starting_slide:1,preload_images:true,swipe:true,swipe_threshold:100,use_css3:true,adjust_height:false,adjust_height_after:false,auto_slide:true,auto_direction:"next",slide_delay:2500,animate_speed:500,arrow_nav:true,bottom_nav:true,custom_bottom_nav:false,load_callback:function(e){},slide_start:function(e){},slide_end:function(e){},bottom_nav_click:function(e){},arrow_click:function(e){},swipe_start:function(e){},swipe_move:function(e){},swipe_end:function(e){}};r=e.extend({},i,r);return this.each(function(){var i=e(this),s=i.children(),o=s.length,u=s.eq(0),a=s.eq(o-1),f,l,c,h,p,d,v,m,g,y,b=false,w=false,E=false,S,x=false,T=false,N,C,k,L=/android|webos|iphone|ipad|ipod|blackberry|windows phone/i.test(navigator.userAgent.toLowerCase()),A=t;window.carouselpsOptions.push({});var O=window.carouselpsOptions[A];t++;var M={prep:function(){if(r.preload_images){var t=s.find("img"),n=0;if(t.length){i.addClass("loading");t.each(function(){var r=e(this).attr("src");e('<img alt="" />').on("load error",function(){n++;if(n===t.length){M.init()}}).attr("src",r)});return}}M.init()},init:function(){M.prepDomAndVars();M.userDefinedFuncs();M.calcs();M.userAvailableFuncs();if(typeof r.load_callback=="function"){var e={$slider:i,$slides:s,$currentSlide:l};r.load_callback(e)}},prepDomAndVars:function(){i.removeClass("loading").addClass("carouselps").attr("data-slider-index",A).wrap("<div class='carouselps-wrapper'><div class='carouselps-wrap'/></div>");p=i.parent();d=p.parent();if(r.starting_slide===0||r.starting_slide>o){r.starting_slide=1}l=s.eq(r.starting_slide-1);l.addClass("current")},userDefinedFuncs:function(){var e=["arrow_nav","bottom_nav","fade","continuous","use_css3","auto_slide","swipe"];for(var t in e){if(r[e[t]]){M[e[t]]()}}c=l.index()},userAvailableFuncs:function(){O.prev=function(){S="prev";M.animate()};O.next=function(){S="next";M.animate()};O.setSlide=function(e){y=e-1;S="bottom";M.animate()};O.refit=M.calcs},fade:function(){r.continuous=false;s.css({position:"absolute",opacity:"0","z-index":"1"});l.css({opacity:"1","z-index":"2"})},use_css3:function(){var e=document.createElement("div"),t=["WebkitPerspective","MozPerspective","OPerspective","msPerspective"];for(var n in t){if(e.style[t[n]]!==undefined){E=true;C=t[n].replace("Perspective","").toLowerCase();N="-"+C+"-transform"}}if(E){if(r.fade){var o={};o["-"+C+"-transition"]="opacity 0s ease-out";o[N]="translate3d(0,0,0)";s.css(o)}else{i.css("-"+C+"-transition","-"+C+"-transform 0s ease-out")}}},calcs:function(){s.width(p.width());h=l.position().left*-1;if(!r.fade){if(E){var e={};e["-"+C+"-transition-duration"]="0s";e[N]="translate3d("+h+"px, 0, 0)";i.css(e)}else{i.css("margin-left",""+h+"px")}}if(r.adjust_height){i.height(l.height())}b=false},continuous:function(){i.prepend(s.clone(true).removeClass("current").addClass("clone clone-before")).append(s.clone(true).removeClass("current").addClass("clone clone-after"));s=i.children()},before_anim:function(){l.removeClass("current");var e;w=false;switch(S){case"prev":if(!u.is(l)||r.continuous){e=c-1}else{e=a.index()}break;case"next":if(!a.is(l)||r.continuous){e=c+1}else{e=u.index()}break;case"bottom":e=r.continuous?y+o:y;break;default:e=c;break}var t=e>c?"next":e<c?"prev":null,n=l;l=s.eq(e);O.preventSlide=false;if(typeof r.slide_start=="function"){var f={$slider:i,$slides:s,$nextSlide:l,$currentSlide:n,direction:t,sliderIndex:A};r.slide_start(f)}if(O.preventSlide){l.removeClass("current");l=n}c=l.index();l.addClass("current")},animate:function(){if(!b){b=true;M.before_anim();if(O.preventSlide){b=false;return}h=l.position().left*-1;if(E){g=r.fade?T?f:l:i;g.bind("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",M.after_anim).css("-"+C+"-transition-duration",r.animate_speed/1e3+"s");if(r.fade){l.css("opacity","1");if(T){f.css("opacity","0")}else{s.css("z-index","1");l.css("z-index","2")}}else{i.css(N,"translate3d("+h+"px, 0, 0)")}}else{if(r.fade){s.css("z-index","1");l.css("z-index","2").animate({opacity:"1"},r.animate_speed,M.after_anim)}else{i.animate({marginLeft:h},r.animate_speed,M.after_anim)}}if(r.bottom_nav){m.removeClass("current");var e=r.continuous?l.hasClass("clone-after")?0:c-o:c;m.eq(e).addClass("current")}if(r.adjust_height&&!r.adjust_height_after){i.animate({height:l.height()},{duration:r.animate_speed,queue:false})}}},after_anim:function(e){if(E){g.unbind("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",M.after_anim)}if(r.continuous){if(l.hasClass("clone")){l.removeClass("current");if(l.hasClass("clone-before")){l=a}else{l=u}l.addClass("current");c=l.index();h=l.position().left*-1;if(r.use_css3&&E){var t={};t["-"+C+"-transition-duration"]="0s";t[N]="translate3d("+h+"px, 0, 0)";i.css(t)}else{i.css("margin-left"," "+h+"px")}}}if(r.fade){if(E){s.css("-"+C+"-transition-duration","0s");if(T){s.css("z-index","1");l.css("z-index","2")}}s.css("opacity","0");l.css("opacity","1")}if(r.adjust_height&&r.adjust_height_after||r.adjust_height&&w){var n=w?r.animate_speed>200?200:r.animate_speed:r.animate_speed;i.stop().animate({height:l.height()},{duration:n,queue:false})}b=false;T=false;if(r.auto_slide){if(k){clearTimeout(k)}if(!x){S=r.auto_direction;k=setTimeout(M.animate,r.slide_delay)}}if(typeof r.slide_end=="function"){var o={$slider:i,$slides:s,$currentSlide:l};r.slide_end(o)}},auto_slide:function(){S=r.auto_direction;k=setTimeout(M.animate,r.slide_delay);d.hover(function(){x=true;if(k){clearTimeout(k)}},function(){x=false;S=r.auto_direction;k=setTimeout(M.animate,r.slide_delay)})},swipe:function(){function U(){n=0;o=0;d=0;v=0;m=true;g=-1;y=null;i.off(j,X).off(F,V);e("html").css({"-ms-touch-action":"auto","touch-action":"auto"});if(D){e("html").unbind(j,X).unbind(F,V)}}function z(e,t){var n=D?e.originalEvent.pointerType==="touch"||e.originalEvent.pointerType===2:true;if(n){switch(t){case"start":n=g===-1;break;case"move":if(D){n=g===e.originalEvent.pointerId}else{n=g===e.originalEvent.targetTouches[0].identifier}break;case"end":if(D){n=g===e.originalEvent.pointerId}else{n=g===e.originalEvent.changedTouches[0].identifier}break}}return n}function W(t){if(!b){if(z(t,"start")){var o=D?t.originalEvent:t.originalEvent.targetTouches[0];n=o.clientX;d=o.clientY;if(E){if(r.fade){l.css("-"+C+"-transition-duration","0s")}else{i.css("-"+C+"-transition-duration","0s")}}I=p.innerWidth();i.bind(j,X).bind(F,V);g=D?t.originalEvent.pointerId:t.originalEvent.targetTouches[0].identifier;e("html").css({"-ms-touch-action":"none","touch-action":"none"});if(D){e("html").bind(j,X).bind(F,V)}if(typeof r.swipe_start=="function"){var u={$slider:i,$slides:s,$currentSlide:l};r.swipe_start(u)}}}}function X(e){R(function(){if(z(e,"move")){var t=D?e.originalEvent:e.originalEvent.targetTouches[0];o=t.clientX-n;v=t.clientY-d;var p=Math.abs(o);if(m){var g={horizontal:Math.abs(v)>p,vertical:Math.abs(v)<p,all:false};m=g[w]}if(!m){e.preventDefault();if(r.auto_slide){clearTimeout(k)}O.preventSwipe=false;if(typeof r.swipe_move=="function"){var y={$slider:i,$slides:s,$currentSlide:l,posX:o,posY:v,sliderIndex:A};r.swipe_move(y)}if(O.preventSwipe){return false}if(E&&!r.fade){movementXOffset=h+o;i.css(N,"translate3d("+movementXOffset+"px,0,0)")}else if(r.fade){if(o!==0){if(o>0){if(l.is(u)){f=a}else{f=s.eq(c-1)}}else{if(l.is(a)){f=u}else{f=s.eq(c+1)}}f.css({"z-index":"3",opacity:0+p/I})}}}else{U()}}})}function V(e){R(function(){if(z(e,"end")){if(!m){if(typeof r.swipe_end=="function"){var t={$slider:i,$slides:s,$currentSlide:l,posX:o,posY:v,sliderIndex:A};r.swipe_end(t)}if(!O.preventSwipe){y={horizontal:o>r.swipe_threshold?"right":o<-r.swipe_threshold?"left":"notReached",vertical:v>r.swipe_threshold?"down":v<-r.swipe_threshold?"up":"notReached",all:null}[w];switch(y){case"left":case"up":S="next";break;case"right":case"down":S="prev";break;case"notReached":T=true;S=null;break}M.animate()}}U()}})}var t={start:{IEedge:"pointerdown",IE10:"MSPointerDown",webkit:"touchstart"},move:{IEedge:"pointermove",IE10:"MSPointerMove",webkit:"touchmove"},end:{IEedge:"pointerup",IE10:"MSPointerUp",webkit:"touchend"},cancel:{IEedge:"pointercancel",IE10:"MSPointerCancel",webkit:"touchcancel"}},n=0,o=0,d=0,v=0,m=true,g=-1,y=null,w="horizontal",x="ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0,L=window.navigator.pointerEnabled,_=window.navigator.msPointerEnabled,D=x?L||_:false,P=D?L?"IEedge":"IE10":"webkit",H=t.cancel[P],B=t.start[P],j=t.move[P],F=t.end[P],I,q={horizontal:"pan-y",vertical:"pan-x",all:"none"}[w],R=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;i.css({"-ms-touch-action":q,"touch-action":q}).bind(B,W).bind(H,U)},arrow_nav:function(){p.append('<span class="carouselps-arrow prev" data-direction="prev"><a></a></span>'+'<span class="carouselps-arrow next" data-direction="next"><a></a></span>');p.children(".carouselps-arrow").bind("click",function(t){t.preventDefault();var n=e(this);S=n.data("direction");M.animate();if(typeof r.arrow_click=="function"){var o={$slider:i,$slides:s,$clickedItem:n,direction:S};r.arrow_click(o)}})},bottom_nav:function(){if(typeof r.custom_bottom_nav=="object"){m=r.custom_bottom_nav}else{var t='<ul class="carouselps-nav-bottom">';for(var n=0;n<o;n++){t+="<li><a></a></li>"}t+="</ul>";d.append(t);v=d.children(".carouselps-nav-bottom");m=v.children()}m.eq(r.starting_slide-1).addClass("current");m.bind("click",function(t){t.preventDefault();var n=e(this);if(!n.hasClass("current")){y=n.index();S="bottom";M.animate()}if(typeof r.bottom_nav_click=="function"){var o={$slider:i,$slides:s,$clickedItem:n};r.bottom_nav_click(o)}})}};M.prep();if(r.responsive){var _,D=true,P,H=n.width()>n.height()?"landscape":"portrait";n.resize(function(){if(_){clearTimeout(_)}_=setTimeout(function(){if(L){P=n.width()>n.height()?"landscape":"portrait";D=P!==H;H=P}if(D){M.calcs();w=true}},100)})}})}})(jQuery)
